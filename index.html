<!DOCTYPE html>
<html lang="en"> 
	<head>
	  <meta charset="UTF-8">
		<title>Alan's Train Simulator</title> 
		<style>
		  canvas {
		    margin-right: 10px;
		  }
		</style>
	</head>
	<body>
		<canvas id="mycanvas"></canvas> 

 
	<script src="https://cdn.jsdelivr.net/processing.js/1.4.8/processing.min.js"></script> 
 	<script>
		var sketchProc = function(processingInstance) {
			with (processingInstance) {
				size(3800, 800); 
				frameRate(60);
        


/////////////////////ProgramCodeGoesHere/////////////////////////////////////


/*A visual of the ATS system*/
/*By Alan*/
/*Based on ProcessingJS library*/

/*
Interactive features so far: 
-click train to toggle ATPM ** only working on some trains
-click station for menu
-station holds, functional
-station close, visual
-system hold toggle
-system energization toggle

Display features:
-somewhat realistic LMAs
-dwells
-run shadows
-variance-dependent run shadow and label colors
-signal aspects
-flank protection

*/

//Code notes: positions are upper left (train, station)
//stations are 26 wide. I'm pretty sure.
//stationPositions 130, 420, 540, 800, 1170, 1340, 1790, 1970, 2080, 2420, 3090, 3210, 3630

//variables

var eastY = 450;
var westY = 346; //346

var power = true;
var systemH = false;

var speed = 60;         //speed
var e = 21;             //eastDwell
var w = 21;             //westDwell

//stationMenus E,W 0=null 1,2=TUN 3,4=BAY 5,6=PIM 7,8=LYO 9,10=PAR 11,12=RID, 13,14=UOT 15,16=LEE 17,18=HUR 19,20=TRE 21,22=STL 23,24=CYR 25,26=BLA
var stationMenus = [false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false];

var variance = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];

var flankUOTwest;
var flankUOTeast;


//constructors

//TrainConstructor
var Trains = function(position, docked, run, dwell, number, doorOpen, atpm, variance, hold, eb, direction, near, jump, line, swt, turnout) {
	this.position = position;
	this.docked = docked;
	this.run = run;
	this.dwell = dwell;
	this.number = number;
	this.doorOpen = doorOpen;
	this.atpm = atpm;
	this.variance = variance;
	this.hold = hold;
	this.eb = eb;
	this.direction = direction;
	this.near = near;
	this.jump = jump;
	this.line = line;
	this.swt = swt;
	this.turnout = turnout;
};

//stationConstructor
var Stations = function(name, position, centerPlatform, eastHold, westHold, eastClose, westClose, dwell) {
	this.name = name;
	this.position = position;
	this.centerPlatform = centerPlatform;
	this.eastHold = eastHold;
	this.westHold = westHold;
	this.eastClose = eastClose;
	this.westClose = westClose;
	this.dwell = dwell;
};

//PseudoConstructor
var Pseudos = function(name, position, both, hold, eastHold, westHold, eastClose, westClose) {
	this.name = name;
	this.position = position;
	this.both = both;
	this.eastHold = eastHold;
	this.westHold = westHold;
	this.eastClose = eastClose;
	this.westClose = westClose;
};

//ShadowConstructor
var Shadows = function(run, position, dwell, docked, near, jump, direction) {
    this.run = run;
    this.position = position;
    this.dwell = dwell;
    this.docked = docked;
    this.near = near;
    this.jump = jump;
    this.direction = direction;
};


//SignalConstructor
var Signals = function(x, y, aspect, direction, label) {
	this.x = x;
	this.y = y;
	this.aspect = aspect;
	this.direction = direction;
	this.label = label;
};

//MenuConstructor
var Menus = function(config) {
    this.x = config.x || 10;
    this.y = config.y || 10;
    this.w = config.w || 80;
    this.h = config.h || 80;
};

//ButtonConstructor
var Button = function(config) {
    this.x = config.x || 25;
    this.y = config.y || 0;
    this.width = config.width || 26;
    this.height = config.height || 12;
    this.label = config.label || " ";
    this.onClick = config.onClick || function() {};
};

//TrackConstructor
var Tracks = function(x, y, length, number, power, close, tsr, wz, westArrow, eastArrow, lma, mrr, select, menu) {
  this.x = x;
  this.y = y;
  this.length = length;
  this.number = number;
  this.power = power;
  this.close = close;
  this.tsr = tsr;
  this.wz = wz;
  this.westArrow = westArrow;
  this.eastArrow = eastArrow;
  this.lma = lma;
  this.mrr = mrr;
  this.select = select;
  this.menu = menu;
};

//CrossoverConstructor
var Crossover = function(x, y, up) {
	this.x = x;
	this.y = y;
	this.up = up;
};






//stations(name, position, centerPlatform, eastHold, westHold, eastClose, westClose, dwell, system)

var tun = new Stations("TUN", 130, false, false, false, false, false, 23);
var bay = new Stations("BAY", 420, false, false, false, false, false, 23);
var pim = new Stations("PIM", 540, true, false, false, false, false, 23);
var lyo = new Stations("LYO", 800, false, false, false, false, false, 23);
var par = new Stations("PAR", 1170, false, false, false, false, false, 23);
var rid = new Stations("RID", 1340, false, false, false, false, false, 23);
var uot = new Stations("UOT", 1790, false, false, false, false, false, 23);
var lee = new Stations("LEE", 1970, false, false, false, false, false, 23);
var hur = new Stations("HUR", 2080, false, false, false, false, false, 23);
var tre = new Stations("TRE", 2420, false, false, false, false, false, 23);
var stl = new Stations("STL", 3090, false, false, false, false, false, 23);
var cyr = new Stations("CYR", 3210, true, false, false, false, false, 23);
var bla = new Stations("BLA", 3630, true, false, false, false, false, 23);

var stationsArray = [tun, bay, pim, lyo, par, rid, uot, lee, hur, tre, stl, cyr, bla];

//pseudos(name, position, both, eastHold, westHold, eastClose, westClose)
var puot = new Pseudos("PUOT", 1520, true, false, false, false, false);
var phur = new Pseudos("PHUR", 2210, false, false, false, false, false);
var ptre = new Pseudos("PTRE", 2280, false, false, false, false, false);



//methods

//trainDrawMethod
Trains.prototype.drawTrain = function() {
	this.position = constrain(this.position, 50, 3750); //unneccesary?
	
	for(var j = 0; j < stationsArray.length; j++) {
		if(this.position >= stationsArray[j].position - 10 && 
		this.position <= stationsArray[j].position + 10 &&
		this.position !== stationsArray[j].position) {
			this.dwell = stationsArray[j].dwell;
			this.near = true;
			this.docked = false;
			j = stationsArray.length;
		} else {
			this.near = false;
		}
	}
	for(var d = 0; d < stationsArray.length; d++) {
		if(this.position === stationsArray[d].position) {
			this.docked = true;
			if((this.direction === 0 && stationsArray[d].eastHold === true) || (this.direction === 1 && stationsArray[d].westHold === true) || systemH === true) {
				this.hold = true;
			} else {
			  this.hold = false;
			}
			d = stationsArray.length;
		}
	}
	
  //moveDistances
	if(this.near === true && this.docked === false) {
		this.jump = 1;
	} else if(this.docked === true) { //possibly unnecessary
		this.jump = 0;
	} else if(this.near === false && this.docked === false) {
		this.jump = floor(random(1, 9));
	}
	//move
	if(frameCount % speed === 0 && this.docked === false && this.direction === 0 && power === true) {
		this.position += this.jump;
	}
	if(frameCount % speed === 0 && this.docked === false && this.direction === 1 && power === true) {
		this.position -= this.jump;
	}
	//depart
	if(this.docked === true && this.hold === false && this.dwell <= 0 && this.direction === 0 && this.line > 0) {
		this.position += 1;
		this.docked = false;
	}
	if(this.docked === true && this.hold === false && this.dwell <= 0 && this.direction === 1 && this.line > 0) {
		this.position -= 1;
		this.docked = false;
	}
	//dwellCount
	if(frameCount % speed === 0 && this.docked === true) {
		this.dwell -= 1;
	}
  //dwellShow
  if(this.line > 0) {
  	textSize(13);
  	if(this.dwell < 0) {
  		fill(230, 0, 0);
  	} else {
  		fill(0, 0, 0);
  	}
  	if(this.docked === true && this.direction === 0) {
  		text(this.dwell, this.position - 35, eastY + 38);
  	}
  	if(this.docked === true && this.direction === 1) {
  		text(this.dwell, this.position - 35, westY - 17);
  	}
  }
  //draw
	strokeWeight(0.5);
	stroke(0, 0, 0);
	fill(0, 250, 250, 150);
	if(this.direction === 0) {
		beginShape(); vertex(this.position, eastY); vertex(this.position + 22, eastY); 
				vertex(this.position + 30, eastY + 8); vertex(this.position + 22, eastY + 15); 
				vertex(this.position, eastY + 15); vertex(this.position, eastY); endShape();
	}
	if(this.direction === 1) {
   		beginShape(); vertex(this.position, westY); vertex(this.position + 22, westY); 
				vertex(this.position + 22, westY + 15); vertex(this.position, westY + 15); 
				vertex(this.position - 8, westY + 8); vertex(this.position, westY); endShape();
	}
  //labelColor
	if(this.variance > 20) {
		stroke(0, 0, 0);
		fill(255, 255, 0);
	} else if(this.variance <= 20 && this.variance >= -20) {
		stroke(255, 255, 255);
		fill(0, 0, 0);
	} else {
		stroke(0, 0, 0);
		fill(0, 255, 0);
	}
	//label
	if(this.direction === 0 && (this.line === 1 || this.line === 7 || this.line === 12 || this.line === 16 || this.line === 18)) {
		textSize(11);
		text("0" + this.run + "BLW" + this.number, this.position - 18, eastY - 6);
	}
	if(this.direction === 1 && (this.line >= 1 && this.line <= 6)) {
		textSize(11);
		text("0" + this.run + "TUW" + this.number, this.position - 18, westY - 6);
	}
	//showATPM
	if(this.atpm === true && this.doorOpen === false) {
		fill(80, 80, 80);
		textSize(13);
		text("P", this.position + 7, eastY + 12);
	}
	//doors
	if(this.docked === true && this.dwell > 4) {
	    this.doorOpen = true;
	} else {
	    this.doorOpen = false;
	}
  if(this.doorOpen === true && this.direction === 0) {
  	noStroke();
		fill(90, 90, 90, 180);
		rect(this.position + 7, eastY + 3, 9, 9);
	}
	if(this.doorOpen === true && this.direction === 1) {
    noStroke();
    fill(90, 90, 90, 180);
    rect(this.position + 6, westY + 3, 9, 9);
  }

		
};



//shadowDrawMethod
Shadows.prototype.drawShadow = function() {
  for(var j = 0; j < stationsArray.length; j++) {
		if(this.position >= stationsArray[j].position +3 && 
		this.position <= stationsArray[j].position + 26 &&
		this.position !== stationsArray[j].position + 13) {
			this.dwell = stationsArray[j].dwell;
			this.near = true;
			this.docked = false;
			j = stationsArray.length;
		} else {
			this.near = false;
		}
	}
	for(var d = 0; d < stationsArray.length; d++) {
		if(this.position === stationsArray[d].position + 13) {
			this.docked = true;
			d = stationsArray.length;
		} 
	}


	if(this.near === true && this.docked === false) {
		this.jump = 1;
	} else if(this.docked === true) {
		this.jump = 0;
	} else if(this.near === false && this.docked === false) {
		this.jump = floor(random(1, 9));
	}
	if(frameCount % speed === 0 && this.docked === false && this.direction === 0) {
		this.position += this.jump;
	}
	if(frameCount % speed === 0 && this.docked === false && this.direction === 1) {
		this.position -= this.jump;
	}
	if(this.docked === true && this.dwell <= 0 && this.direction === 0) {
		this.position += 1;
		this.docked = false;
	}
	if(this.docked === true && this.dwell <= 0 && this.direction === 1) {
		this.position -= 1;
		this.docked = false;
	}
	if(frameCount % speed === 0 && this.docked === true) {
		this.dwell -= 1;
	}
	
	if(this.direction === 0) {
  	strokeWeight(0.4);
    if(variance[1] > 100) {
      stroke(0, 0, 0);
      fill(255, 255, 0);
    } else if(variance[1] <= 100 && variance[1] >- 11) {
      stroke(255, 255, 255);
      fill(0, 0, 0);
    } else {
      stroke(0, 0, 0);
      fill(0, 255, 0);
    }
    ellipse(this.position, eastY + 8, 14, 14);
  }
  if(this.direction === 1) {
    strokeWeight(0.4);
    if(variance[7] > 100) {
        stroke(0, 0, 0);
        fill(255, 255, 0);
    } else if(variance[7] <= 100 && variance[7] >- 11) {
        stroke(255, 255, 255);
        fill(0, 0, 0);
    } else {
        stroke(0, 0, 0);
        fill(0, 255, 0);
    }
    ellipse(this.position, westY + 8, 14, 14);
  }
	
};




/*
BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
*/




//tracksDrawMethod  x, y, length, number, power, close, tsr, wz, westArrow, eastArrow, lma, mrr, select, menu
Tracks.prototype.drawTrack = function() {
  noStroke();
  if(this.close === true) {
    fill(255, 0, 0);
  } else if(this.tsr < 100 || this.wz === true) {
    fill(0, 128, 128);
  } else {
  fill(192, 192, 192);
  }
  rect(this.x, this.y + 2, this.length, 11);

  if(this.power === false) {
      stroke(0, 255, 0);
      strokeWeight(3);
      line(this.x + 1, this.y + 2, this.x + this.length - 2, this.y + 2);
      line(this.x + 1, this.y + 13, this.x + this. length - 2, this.y + 13);
  } else if(this.wz === true) {
      stroke(255, 130, 0);
      strokeWeight(4);
      line(this.x + 1, this.y + 1, this.x + this.length - 2, this.y + 1);
      line(this.x + 1, this.y + 14, this.x + this. length - 2, this.y + 14);
  }
  
  strokeWeight(3);
  if(this.select === true || this.lma === true || this.mrr === true) {
    if(this.select === true) {
      stroke(0, 0, 160);
      fill(0, 0, 160);
    } else if(this.lma === true) {
      stroke(0, 255, 0);
      fill(0, 255, 0);
    } else if(this.mrr === true) {
      stroke(255, 0, 0);
      fill(255, 0, 0);
    }
    line(this.x + 2, this.y + 7, this.x + this.length - 2, this.y + 7);
    noStroke();
    if(this.westArrow === true) {
      triangle(this.x + 1, this.y + 7, this.x + 7, this.y + 3, this.x + 7, this.y + 12);
    }
    if(this.eastArrow === true) {
      triangle(this.x + this.length, this.y + 7, this.x + this.length - 7, this.y + 3, this.x + this.length - 7, this.y + 12);
    }
  }
};
      




//signalsDrawMethod
Signals.prototype.drawSignal = function() {
	strokeWeight(3);
	stroke(0, 0, 0);
	if(this.direction === 0) {
		line(this.x - 6, this.y - 4, this.x - 6, this.y + 4);
	} else {
		line(this.x + 5, this.y - 4, this.x + 5, this.y + 4);
	}
	strokeWeight(1);
	stroke(0, 0, 0);
	if(this.aspect === 1) {
		fill(0, 255, 0);
	} else if(this.aspect === 2) {
		fill(255, 255, 255);
	} else {
		fill(255, 0, 0);
	}
	ellipse(this.x, this.y, 7, 7);
};





var drawEastPortal = function(x) {
        strokeWeight(4);     //eastPortal
        noFill();
        stroke(0, 0, 0);
        beginShape(); vertex(x + 10, westY - 16); vertex(x, westY - 6); vertex(x, eastY + 20); vertex(x + 10, eastY + 30); endShape();
};

var drawWestPortal = function(x) {
        strokeWeight(4);
        noFill();
        stroke(0, 0, 0);
        beginShape(); vertex(x - 10, westY - 16); vertex(x, westY - 6); vertex(x, eastY + 20); vertex(x - 10, eastY + 30); endShape();
};

var markerDraw = function(x, y) {
    noFill();
    stroke(0, 0, 0);
    strokeWeight(0.4);
    triangle(x - 2.5, y - 4, x + 2.5, y - 4, x, y);    
};

var zoneBorderDraw = function(x) {
	for(i = 0; i < 18; i++) {
		fill(0, 0, 0);
		noStroke();
		rect(x, (westY - 48) + i*12, 3, 10);
	}
};

var gidsDraw = function(x) {
    stroke(0, 0, 0);
    fill(128, 128, 128);
    strokeWeight(0.2);
    rect(x, westY - 44, 4, 208);
};

Crossover.prototype.drawCross = function(x, y, up) { //x, 365, t/f
  fill(192, 192, 192);
  noStroke();
  if(this.up === true) {
	 	quad(this.x + 5, this.y + 73, this.x + 14, this.y + 79, this.x + 61, this.y + 6, this.x + 53, this.y);
	} else {
		quad(this.x + 5, this.y + 6, this.x + 14, this.y, this.x + 61, this.y + 73, this.x + 53, this.y + 79);    
	}
};






//StationDrawMethod
Stations.prototype.drawStation = function() {
    //GIDS
    gidsDraw(this.position - 4);
    gidsDraw(this.position + 28);
    
    //markers
    markerDraw(this.position + 5, westY - 2);
    markerDraw(this.position + 22, westY - 2);
    markerDraw(this.position + 5, eastY - 2);
    markerDraw(this.position + 22, eastY - 2);
    
    //platforms
    strokeWeight(0.5);
    if(this.centerPlatform === false) {
        if(this.eastClose === true) {
            fill(195, 0, 0);
        } else {
            fill(0, 0, 255);
        }
        stroke(0, 0, 0);
        rect(this.position, eastY + 36, 26, 12);
        if(this.eastHold === true) {
            fill(255, 255, 0);
            rect(this.position, eastY + 36, 26, 6);
        }
        if(systemH === true) {
            fill(0, 255, 0);
            rect(this.position, eastY + 36, 26, 6);
        }
        
        if(this.westClose === true) {
            fill(195, 0, 0);
        } else {
            fill(0, 0, 230);
        }
        stroke(0, 0, 0);
        rect(this.position, westY - 36, 26, 12);
        if(this.westHold === true) {
            fill(255, 255, 0);
            rect(this.position, westY - 30, 26, 6);
        }
        if(systemH === true) {
            fill(0, 255, 0);
            rect(this.position, westY - 30, 26, 6);
        }
    } else {                                //centerPlatform
        if(this.eastClose === true) {
            fill(195, 0, 0);
        } else {
            fill(0, 0, 255);
        }
        stroke(0, 0, 0);
        rect(this.position, eastY - 38, 26, 12);
        if(this.eastHold === true) {
            fill(255, 255, 0);
            rect(this.position, eastY - 32, 26, 6);
        }
        if(systemH === true) {
            fill(0, 255, 0);
            rect(this.position, eastY - 32, 26, 6);
        }
        
        if(this.westClose === true) {
            fill(195, 0, 0);
        } else {
            fill(0, 0, 230);
        }
        stroke(0, 0, 0);
        rect(this.position, westY + 42, 26, 12);
        if(this.westHold === true) {
          fill(255, 255, 0);
          rect(this.position, westY + 42, 26, 6);
        }
        if(systemH === true) {
          fill(0, 255, 0);
          rect(this.position, westY + 42, 26, 6);
        }
    }
    
    //platformLabels
    fill(0, 255, 0);
    textSize(13);
    if(this.centerPlatform === false) {
      text(this.name + "-E", this.position - 6, eastY + 71);
       text(this.name + "-W", this.position - 6, westY - 51);
    } else {
       text(this.name + "-E", this.position + 38, eastY - 26);
      text(this.name + "-W", this.position + 38, westY + 53);
    }

};

//PseudoDrawMethod
Pseudos.prototype.drawPseudo = function() {
    noStroke();
    fill(88, 88, 88);
    rect(this.position, westY - 36, 26, 12);

    fill(0, 255, 0);
    textSize(13);
    text(this.name + "-W", this.position - 12, westY - 46);
    if(this.both === true) {
      fill(88, 88, 88);
	    rect(this.position, eastY + 36, 26, 12);
	    fill(0, 255, 0);
      text(this.name + "-E", this.position - 12, eastY + 70);
    }
  	markerDraw(this.position + 1, westY - 2);
  	markerDraw(this.position + 19, westY - 2);
  	if(this.both === true) {
  		markerDraw(this.position + 1, eastY - 2);
  		markerDraw(this.position + 19, eastY - 2);
  	}
};


//ButtonMethods
Button.prototype.isMouseInside = function() {
	return mouseX > this.x &&
		mouseX < (this.x + this.width) &&
		mouseY > this.y &&
		mouseY < (this.y + this.height);
};

Button.prototype.handleMouseClick = function() {
	if (this.isMouseInside()) {
		this.onClick();
		}
};

Button.prototype.draw = function() {
    fill(255, 255, 255);
    rect(this.x, this.y, this.width, this.height);
    //fill(0, 0, 0);
    //textSize(19);
    //textAlign(LEFT, TOP);
    //text(this.label, this.x+10, this.y+this.height/4);
    //text("test", this.x, this.y);
};



//StationMenuMethod
Menus.prototype.drawStationMenu = function() {
    fill(210, 210, 210);
    stroke(0,0,0);
    strokeWeight(1);
    rect(this.x + 20, this.y + 10, this.w, this.h);
    fill(0, 0, 0);
    textSize(12);
    text("Set/Clear Hold", this.x + 26, this.y + 26);
    text("Open/Close", this.x + 26, this.y + 42);
    text("Adjust Dwells", this.x + 26, this.y + 58);
};
    
    
/////////////////////////////////////////////////////////////////////Instances

//TrackInstances      x, y, length, number, power, close, tsr, wz, westArrow, eastArrow, lma, mrr, select, menu

var track100 = new Tracks(50,  westY, 80, 100, true, false, 100, false, false, false, false, false, false, false);
var track101 = new Tracks(130, westY, 26, 101, true, false, 100, false, false, false, false, false, false, false);
var track102 = new Tracks(156, westY, 24, 102, true, false, 100, false, false, false, false, false, false, false);
var track103 = new Tracks(200, westY, 25, 103, true, false, 100, false, false, false, false, false, false, false);
var track104 = new Tracks(245, westY, 40, 104, true, false, 100, false, false, false, false, false, false, false);
var track105 = new Tracks(285, westY, 47, 105, true, false, 100, false, false, false, false, false, false, false);
var track106 = new Tracks(332, westY, 47, 106, true, false, 100, false, false, false, false, false, false, false);
var track107 = new Tracks(379, westY, 41, 107, true, false, 100, false, false, false, false, false, false, false);
var track108 = new Tracks(420, westY, 26, 108, true, false, 100, false, false, false, false, false, false, false);
var track109 = new Tracks(446, westY, 30, 109, true, false, 100, false, false, false, false, false, false, false);
var track110 = new Tracks(476, westY, 34, 110, true, false, 100, false, false, false, false, false, false, false);
var track111 = new Tracks(510, westY, 30, 111, true, false, 100, false, false, false, false, false, false, false);
var track112 = new Tracks(540, westY, 26, 112, true, false, 100, false, false, false, false, false, false, false);
var track113 = new Tracks(566, westY, 34, 113, true, false, 100, false, false, false, false, false, false, false);
var track114 = new Tracks(600, westY, 60, 114, true, false, 100, false, false, false, false, false, false, false);
var track115 = new Tracks(660, westY, 60, 115, true, false, 100, false, false, false, false, false, false, false);
var track116 = new Tracks(720, westY, 50, 116, true, false, 100, false, false, false, false, false, false, false);
var track117 = new Tracks(770, westY, 30, 117, true, false, 100, false, false, false, false, false, false, false);
var track118 = new Tracks(800, westY, 26, 118, true, false, 100, false, false, false, false, false, false, false);
var track119 = new Tracks(826, westY, 72, 119, true, false, 100, false, false, false, false, false, false, false);
var track120 = new Tracks(898, westY, 72, 120, true, false, 100, false, false, false, false, false, false, false);
var track121 = new Tracks(990, westY, 25, 121, true, false, 100, false, false, false, false, false, false, false);
var track122 = new Tracks(1035, westY, 72, 122, true, false, 100, false, false, false, false, false, false, false);
var track123 = new Tracks(1107, westY, 63, 123, true, false, 100, false, false, false, false, false, false, false);
var track124 = new Tracks(1170, westY, 26, 124, true, false, 100, false, false, false, false, false, false, false);
var track125 = new Tracks(1196, westY, 22, 125, true, false, 100, false, false, false, false, false, false, false);
var track126 = new Tracks(1218, westY, 50, 126, true, false, 100, false, false, false, false, false, false, false);
var track127 = new Tracks(1268, westY, 50, 127, true, false, 100, false, false, false, false, false, false, false);
var track128 = new Tracks(1318, westY, 22, 128, true, false, 100, false, false, false, false, false, false, false);
var track129 = new Tracks(1340, westY, 26, 129, true, false, 100, false, false, false, false, false, false, false);
var track130 = new Tracks(1366, westY, 19, 130, true, false, 100, false, false, false, false, false, false, false);
var track131 = new Tracks(1385, westY, 50, 131, true, false, 100, false, false, false, false, false, false, false);
var track132 = new Tracks(1435, westY, 50, 132, true, false, 100, false, false, false, false, false, false, false);
var track133 = new Tracks(1485, westY, 20, 133, true, false, 100, false, false, false, false, false, false, false);
var track134 = new Tracks(1505, westY, 65, 134, true, false, 100, false, false, false, false, false, false, false);
var track135 = new Tracks(1590, westY, 25, 135, true, false, 100, false, false, false, false, false, false, false);
var track136 = new Tracks(1635, westY, 65, 136, true, false, 100, false, false, false, false, false, false, false);
var track137 = new Tracks(1700, westY, 90, 137, true, false, 100, false, false, false, false, false, false, false);
var track138 = new Tracks(1790, westY, 26, 138, true, false, 100, false, false, false, false, false, false, false);
var track139 = new Tracks(1816, westY, 27, 139, true, false, 100, false, false, false, false, false, false, false);
var track140 = new Tracks(1843, westY, 50, 140, true, false, 100, false, false, false, false, false, false, false);
var track141 = new Tracks(1893, westY, 50, 141, true, false, 100, false, false, false, false, false, false, false);
var track142 = new Tracks(1943, westY, 27, 142, true, false, 100, false, false, false, false, false, false, false);
var track143 = new Tracks(1970, westY, 26, 143, true, false, 100, false, false, false, false, false, false, false);
var track144 = new Tracks(1996, westY, 19, 144, true, false, 100, false, false, false, false, false, false, false);
var track145 = new Tracks(2015, westY, 20, 145, true, false, 100, false, false, false, false, false, false, false);
var track146 = new Tracks(2035, westY, 10, 146, true, false, 100, false, false, false, false, false, false, false);
var track147 = new Tracks(2045, westY, 10, 147, true, false, 100, false, false, false, false, false, false, false);
var track148 = new Tracks(2055, westY, 25, 148, true, false, 100, false, false, false, false, false, false, false);
var track149 = new Tracks(2080, westY, 26, 149, true, false, 100, false, false, false, false, false, false, false);
var track150 = new Tracks(2106, westY, 34, 150, true, false, 100, false, false, false, false, false, false, false);
var track151 = new Tracks(2140, westY, 35, 151, true, false, 100, false, false, false, false, false, false, false);
var track152 = new Tracks(2195, westY, 26, 152, true, false, 100, false, false, false, false, false, false, false);
var track153 = new Tracks(2221, westY, 73, 153, true, false, 100, false, false, false, false, false, false, false);
var track154 = new Tracks(2294, westY, 26, 154, true, false, 100, false, false, false, false, false, false, false);
var track155 = new Tracks(2340, westY, 16, 155, true, false, 100, false, false, false, false, false, false, false);
var track156 = new Tracks(2356, westY, 32, 156, true, false, 100, false, false, false, false, false, false, false);
var track157 = new Tracks(2388, westY, 32, 157, true, false, 100, false, false, false, false, false, false, false);
var track158 = new Tracks(2420, westY, 26, 158, true, false, 100, false, false, false, false, false, false, false);
var track159 = new Tracks(2446, westY, 85, 159, true, false, 100, false, false, false, false, false, false, false);
var track160 = new Tracks(2531, westY, 44, 160, true, false, 100, false, false, false, false, false, false, false);
var track161 = new Tracks(2595, westY, 35, 161, true, false, 100, false, false, false, false, false, false, false);
var track162 = new Tracks(2650, westY, 30, 162, true, false, 100, false, false, false, false, false, false, false);
var track163 = new Tracks(2680, westY, 195, 163, true, false, 100, false, false, false, false, false, false, false);
var track164 = new Tracks(2875, westY, 30, 164, true, false, 100, false, false, false, false, false, false, false);
var track165 = new Tracks(2925, westY, 35, 165, true, false, 100, false, false, false, false, false, false, false);
var track166 = new Tracks(2980, westY, 90, 166, true, false, 100, false, false, false, false, false, false, false);
var track167 = new Tracks(3070, westY, 10, 167, true, false, 100, false, false, false, false, false, false, false);
var track168 = new Tracks(3080, westY, 10, 168, true, false, 100, false, false, false, false, false, false, false);
var track169 = new Tracks(3090, westY, 26, 169, true, false, 100, false, false, false, false, false, false, false);
// 20swtgap 25seg 20swtgap
//stationPositions  STL3090, 3210, 3630
//t1 2905
//   2860 2960    3440 3540 swts
//t2
//zone3175
//stl3060-3150portals

var track200 = new Tracks(50,  eastY, 80, 200, true, false, 100, false, false, false, false, false, false, false);
var track201 = new Tracks(130, eastY, 26, 201, true, false, 100, false, false, false, false, false, false, false);
var track202 = new Tracks(156, eastY, 24, 202, true, false, 100, false, false, false, false, false, false, false);
var track203 = new Tracks(200, eastY, 25, 203, true, false, 100, false, false, false, false, false, false, false);
var track204 = new Tracks(245, eastY, 40, 204, true, false, 100, false, false, false, false, false, false, false);
var track205 = new Tracks(285, eastY, 47, 205, true, false, 100, false, false, false, false, false, false, false);
var track206 = new Tracks(332, eastY, 47, 206, true, false, 100, false, false, false, false, false, false, false);
var track207 = new Tracks(379, eastY, 41, 207, true, false, 100, false, false, false, false, false, false, false);
var track208 = new Tracks(420, eastY, 26, 208, true, false, 100, false, false, false, false, false, false, false);
var track209 = new Tracks(446, eastY, 30, 209, true, false, 100, false, false, false, false, false, false, false);
var track210 = new Tracks(476, eastY, 34, 210, true, false, 100, false, false, false, false, false, false, false);
var track211 = new Tracks(510, eastY, 30, 211, true, false, 100, false, false, false, false, false, false, false);
var track212 = new Tracks(540, eastY, 26, 212, true, false, 100, false, false, false, false, false, false, false);
var track213 = new Tracks(566, eastY, 34, 213, true, false, 100, false, false, false, false, false, false, false);
var track214 = new Tracks(600, eastY, 60, 214, true, false, 100, false, false, false, false, false, false, false);
var track215 = new Tracks(660, eastY, 60, 215, true, false, 100, false, false, false, false, false, false, false);
var track216 = new Tracks(720, eastY, 50, 216, true, false, 100, false, false, false, false, false, false, false);
var track217 = new Tracks(770, eastY, 30, 217, true, false, 100, false, false, false, false, false, false, false);
var track218 = new Tracks(800, eastY, 26, 218, true, false, 100, false, false, false, false, false, false, false);
var track219 = new Tracks(826, eastY, 72, 219, true, false, 100, false, false, false, false, false, false, false);
var track220 = new Tracks(898, eastY, 72, 220, true, false, 100, false, false, false, false, false, false, false);
var track221 = new Tracks(990, eastY, 25, 221, true, false, 100, false, false, false, false, false, false, false);
var track222 = new Tracks(1035, eastY, 72, 222, true, false, 100, false, false, false, false, false, false, false);
var track223 = new Tracks(1107, eastY, 63, 223, true, false, 100, false, false, false, false, false, false, false);
var track224 = new Tracks(1170, eastY, 26, 224, true, false, 100, false, false, false, false, false, false, false);
var track225 = new Tracks(1196, eastY, 22, 225, true, false, 100, false, false, false, false, false, false, false);
var track226 = new Tracks(1218, eastY, 50, 226, true, false, 100, false, false, false, false, false, false, false);
var track227 = new Tracks(1268, eastY, 50, 227, true, false, 100, false, false, false, false, false, false, false);
var track228 = new Tracks(1318, eastY, 22, 228, true, false, 100, false, false, false, false, false, false, false);
var track229 = new Tracks(1340, eastY, 26, 229, true, false, 100, false, false, false, false, false, false, false);
var track230 = new Tracks(1366, eastY, 19, 230, true, false, 100, false, false, false, false, false, false, false);
var track231 = new Tracks(1385, eastY, 50, 231, true, false, 100, false, false, false, false, false, false, false);
var track232 = new Tracks(1435, eastY, 50, 232, true, false, 100, false, false, false, false, false, false, false);
var track233 = new Tracks(1485, eastY, 20, 233, true, false, 100, false, false, false, false, false, false, false);
var track234 = new Tracks(1505, eastY, 65, 234, true, false, 100, false, false, false, false, false, false, false);
var track235 = new Tracks(1590, eastY, 25, 235, true, false, 100, false, false, false, false, false, false, false);
var track236 = new Tracks(1635, eastY, 65, 236, true, false, 100, false, false, false, false, false, false, false);
var track237 = new Tracks(1700, eastY, 90, 237, true, false, 100, false, false, false, false, false, false, false);
var track238 = new Tracks(1790, eastY, 26, 238, true, false, 100, false, false, false, false, false, false, false);
var track239 = new Tracks(1816, eastY, 27, 239, true, false, 100, false, false, false, false, false, false, false);
var track240 = new Tracks(1843, eastY, 50, 240, true, false, 100, false, false, false, false, false, false, false);
var track241 = new Tracks(1893, eastY, 50, 241, true, false, 100, false, false, false, false, false, false, false);
var track242 = new Tracks(1943, eastY, 27, 242, true, false, 100, false, false, false, false, false, false, false);
var track243 = new Tracks(1970, eastY, 26, 242, true, false, 100, false, false, false, false, false, false, false);
var track244 = new Tracks(1996, eastY, 19, 244, true, false, 100, false, false, false, false, false, false, false);
var track245 = new Tracks(2015, eastY, 20, 245, true, false, 100, false, false, false, false, false, false, false);
var track245 = new Tracks(2015, eastY, 20, 245, true, false, 100, false, false, false, false, false, false, false);
var track246 = new Tracks(2035, eastY, 10, 246, true, false, 100, false, false, false, false, false, false, false);
var track247 = new Tracks(2045, eastY, 10, 247, true, false, 100, false, false, false, false, false, false, false);
var track248 = new Tracks(2055, eastY, 25, 248, true, false, 100, false, false, false, false, false, false, false);
var track249 = new Tracks(2080, eastY, 26, 249, true, false, 100, false, false, false, false, false, false, false);
var track250 = new Tracks(2106, eastY, 24, 250, true, false, 100, false, false, false, false, false, false, false);
var track251 = new Tracks(2150, eastY, 25, 251, true, false, 100, false, false, false, false, false, false, false);
var track252 = new Tracks(2175, eastY, 165, 252, true, false, 100, false, false, false, false, false, false, false);
var track253 = new Tracks(2340, eastY, 25, 253, true, false, 100, false, false, false, false, false, false, false);
var track254 = new Tracks(2385, eastY, 15, 254, true, false, 100, false, false, false, false, false, false, false);
var track255 = new Tracks(2400, eastY, 20, 255, true, false, 100, false, false, false, false, false, false, false);
var track256 = new Tracks(2420, eastY, 26, 256, true, false, 100, false, false, false, false, false, false, false);
var track257 = new Tracks(2446, eastY, 50, 257, true, false, 100, false, false, false, false, false, false, false);
var track258 = new Tracks(2496, eastY, 34, 258, true, false, 100, false, false, false, false, false, false, false);
var track259 = new Tracks(2550, eastY, 25, 259, true, false, 100, false, false, false, false, false, false, false);
var track260 = new Tracks(2575, eastY, 75, 260, true, false, 100, false, false, false, false, false, false, false);
var track261 = new Tracks(2650, eastY, 25, 261, true, false, 100, false, false, false, false, false, false, false);
var track262 = new Tracks(2695, eastY, 15, 262, true, false, 100, false, false, false, false, false, false, false);
var track263 = new Tracks(2730, eastY, 95, 263, true, false, 100, false, false, false, false, false, false, false);
var track264 = new Tracks(2845, eastY, 15, 264, true, false, 100, false, false, false, false, false, false, false);
var track265 = new Tracks(2880, eastY, 125, 265, true, false, 100, false, false, false, false, false, false, false);
var track266 = new Tracks(3025, eastY, 45, 266, true, false, 100, false, false, false, false, false, false, false);
var track267 = new Tracks(3070, eastY, 10, 267, true, false, 100, false, false, false, false, false, false, false);
var track268 = new Tracks(3080, eastY, 10, 268, true, false, 100, false, false, false, false, false, false, false);
var track269 = new Tracks(3090, eastY, 26, 269, true, false, 100, false, false, false, false, false, false, false);
// 20swtgap 25seg 20swtgap
//stationPositions  STL3090, 3210, 3630
//t1
//     2860 2960     3440 3540 swts
//t2
//zone3175
//stl3060-3150portals
var tracksArray = [track100, track101, track102, track103, track104, track105, track106, track107, track108, track109,
                  track110, track111, track112, track113, track114, track115, track116, track117, track118, track119,
                  track120, track121, track122, track123, track124, track125, track126, track127, track128, track129,
                  track130, track131, track132, track133, track134, track135, track136, track137, track138, track139,
                  track140, track141, track142, track143, track144, track145, track146, track147, track148, track149,
                  track150, track151, track152, track153, track154, track155, track156, track157, track158, track159,
                  track160, track161, track162, track163, track164, track165, track166, track167, track168, track169,
                  
                  track200, track201, track202, track203, track204, track205, track206, track207, track208, track209,
                  track210, track211, track212, track213, track214, track215, track216, track217, track218, track219,
                  track220, track221, track222, track223, track224, track225, track226, track227, track228, track229,
                  track230, track231, track232, track233, track234, track235, track236, track237, track238, track239, 
                  track240, track241, track242, track243, track244, track245, track246, track247, track248, track249,
                  track250, track251, track252, track253, track254, track255, track256, track257, track258, track259,
                  track260, track261, track262, track263, track264, track265, track266, track267, track268, track269,
                  ];

    

var trainNums = ["01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12", "13", "14", "15"];
var shuffler = function(array) {
	var c = array.length;
	while (c > 0) {
		var ind = Math.floor(Math.random() * c);
		c--;
		var temp = array[c];
		array[c] = array[ind];
		array[ind] = temp;
	}
};
shuffler(trainNums);



//Trains         (position, dock,   run,   dwl, num, drOpen, atpm, vrnc, hold, eb, dir, dock, jump, line, swt, turnout)

var trainA = new Trains(130,  false, 101, 20, "01", false, false, 0, false, false, 0, false, 0, 1, false, false);
var trainB = new Trains(575,  false, 102, 20, "02", false, false, 0, false, false, 0, false, 0, 1, false, false);
var trainC = new Trains(1155, false, 103, 20, "03", false, false, 0, false, false, 0, false, 0, 1, false, false);
var trainD = new Trains(1610, false, 104, 20, "04", false, false, 0, false, false, 0, false, 0, 1, false, false);
var trainE = new Trains(2058, false, 105, 20, "05", false, false, 0, false, false, 0, false, 0, 1, false, false);
var trainF = new Trains(2800, false, 106, 20, "06", false, false, 0, false, false, 0, false, 0, 1, false, false);
var trainG = new Trains(3200, false, 107, 20, "07", false, false, 0, false, false, 0, false, 0, 1, false, false);
var trainH = new Trains(3600, false, 108, 20, "08", false, false, 0, false, false, 1, false, 0, 1, false, false);
var trainI = new Trains(3200, false, 109, 20, "09", false, false, 0, false, false, 1, false, 0, 1, false, false);
var trainJ = new Trains(2758, false, 110, 20, "10", false, false, 0, false, false, 1, false, 0, 1, false, false);
var trainK = new Trains(2199, false, 111, 20, "11", false, false, 0, false, false, 1, false, 0, 1, false, false);
var trainL = new Trains(1750, false, 112, 20, "12", false, false, 0, false, false, 1, false, 0, 1, false, false);
var trainM = new Trains(1345, false, 113, 20, "13", false, false, 0, false, false, 1, false, 0, 1, false, false);
var trainN = new Trains(856,  false, 114, 20, "14", false, false, 0, false, false, 1, false, 0, 1, false, false);
var trainO = new Trains(466,  false, 115, 20, "15", false, false, 0, false, false, 1, false, 0, 1, false, false);

var trainsArray = [trainA, trainB, trainC, trainD, trainE, trainF, 
		trainG, trainH, trainI, trainJ, trainK, trainL, trainM, trainN, trainO];

for(var t = 0; t < trainsArray.length; t++) {
	trainsArray[t].number = trainNums[t];
}

//runs (run, position, dwell, docked, near, jump, direction)
var run101 = new Shadows(101, 143, 25, false, false, 0, 0);
var run102 = new Shadows(102, 585, 25, false, false, 0, 0);
var run103 = new Shadows(103, 1155, 25, false, false, 0, 0);
var run104 = new Shadows(104, 1610, 25, false, false, 0, 0);
var run105 = new Shadows(105, 2058, 25, false, false, 0, 0);
var run106 = new Shadows(106, 2800, 25, false, false, 0, 0);
var run107 = new Shadows(107, 3200, 25, false, false, 0, 0);
var run108 = new Shadows(108, 3600, 25, false, false, 0, 1);
var run109 = new Shadows(109, 3200, 25, false, false, 0, 1);
var run110 = new Shadows(110, 2758, 25, false, false, 0, 1);
var run111 = new Shadows(111, 2199, 25, false, false, 0, 1);
var run112 = new Shadows(112, 1750, 25, false, false, 0, 1);
var run113 = new Shadows(113, 1345, 25, false, false, 0, 1);
var run114 = new Shadows(114, 856, 25, false, false, 0, 1);
var run115 = new Shadows(115, 466, 25, false, false, 0, 1);

var runsArray = [run101, run102, run103, run104, run104, run106, run107, run108, run109, run110, run111, run112, run113, run114, run115];





//signalInstances      (x, y, aspect, direction, label)

var sig11 = new Signals(tun.position + 47, westY + 31, 0, 0, "1-E-1");
var sig12 = new Signals(tun.position + 41, eastY + 29, 0, 0, "1-E-2");
var sig13 = new Signals(tun.position + 130, westY - 14, 0, 1, "1-W-3");
var sig14 = new Signals(tun.position + 130, eastY - 14, 0, 1, "1-W-4");

var sig21 = new Signals(lyo.position + 157, westY + 31, 0, 0, "2-E-1");
var sig22 = new Signals(lyo.position + 166, eastY + 29, 0, 0, "2-E-2");
var sig23 = new Signals(lyo.position + 235, westY - 14, 0, 1, "2-W-3");
var sig24 = new Signals(lyo.position + 242, eastY - 14, 0, 1, "2-W-4");
var sig25 = new Signals(puot.position + 47, westY + 31, 0, 0, "2-E-5");
var sig26 = new Signals(puot.position + 24, eastY + 27, 0, 0, "2-E-6");
var sig27 = new Signals(puot.position + 130, westY - 14, 0, 1, "2-W-7");
var sig28 = new Signals(puot.position + 130, eastY - 14, 0, 1, "2-W-8");

var sig31 = new Signals(hur.position + 85, westY + 26, 0, 0, "3-E-1");
var sig32 = new Signals(hur.position + 47, eastY + 27, 0, 0, "3-E-2");
var sig33 = new Signals(hur.position + 129, westY - 15, 0, 1, "3-W-3");
var sig34 = new Signals(hur.position + 98, eastY - 15, 0, 1, "3-W-4");
var sig35 = new Signals(tre.position - 110, westY + 26, 0, 0, "3-E-5");
var sig36 = new Signals(tre.position - 67, eastY + 27, 0, 0, "3-E-6");
var sig37 = new Signals(tre.position - 69, westY - 15, 0, 1, "3-W-7");
var sig38 = new Signals(tre.position - 30, eastY - 15, 0, 1, "3-W-8");
var sig39 = new Signals(tre.position + 135, westY + 26, 0, 0, "3-E-9");
var sig310 = new Signals(tre.position + 97, eastY + 27, 0, 0, "3-E-10");
var sig311 = new Signals(tre.position + 179, westY - 15, 0, 1, "3-W-11");
var sig312 = new Signals(tre.position + 148, eastY - 15, 0, 1, "3-W-12");
var sig313 = new Signals(tre.position + 207, westY + 26, 0, 0, "3-E-13");
var sig314 = new Signals(tre.position + 242, eastY + 27, 0, 0, "3-E-14");
var sig315 = new Signals(tre.position + 250, westY - 15, 0, 1, "3-W-15");
var sig316 = new Signals(tre.position + 330, eastY - 12, 0, 1, "3-W-16");
var sig318 = new Signals(tre.position + 381, eastY + 26, 0, 0, "3-W-18");
var sig320 = new Signals(tre.position + 409, eastY - 12, 0, 1, "3-W-20");
var sig321 = new Signals(stl.position - 200, westY + 26, 0, 0, "3-E-21");
var sig322 = new Signals(stl.position - 230, eastY + 26, 0, 0, "3-E-22");
var sig323 = new Signals(stl.position - 115, westY - 15, 0, 1, "3-W-23");
var sig324 = new Signals(stl.position - 60, eastY - 15, 0, 1, "3-W-24");

var sig41 = new Signals(bla.position - 200, westY + 26, 0, 0, "4-E-1");
var sig42 = new Signals(bla.position - 152, eastY + 26, 0, 0, "4-E-2");
var sig43 = new Signals(bla.position - 20, westY - 15, 0, 1, "4-W-3");
var sig44 = new Signals(bla.position - 50, eastY - 15, 0, 1, "4-W-4");

var signalsArray = [sig11, sig12, sig13, sig14, sig21, sig22, sig23, sig24, sig25, sig26, sig27, sig28, sig31, sig32, sig33, sig34, sig35, sig36, sig37, sig38, sig39, sig310, sig311, sig312, sig313, sig314, sig315, sig316, sig318, sig320, sig321, sig322, sig323, sig324, sig41, sig42, sig43, sig44];


var cross1 = new Crossover(tun.position + 50, 365, true);	//crossovers (x, 365, up)
var cross2 = new Crossover(tun.position + 50, 365, false);
var cross3 = new Crossover(lyo.position + 170, 365, true);
var cross4 = new Crossover(lyo.position + 170, 365, false);
var cross5 = new Crossover(puot.position + 50, 365, true);
var cross6 = new Crossover(puot.position + 50, 365, false);
var cross7 = new Crossover(2130, 365, true); //hur
var cross8 = new Crossover(2320, 365, false);
var cross9 = new Crossover(2530, 365, true);
var cross10 = new Crossover(2630, 365, false);
var cross11 = new Crossover(2860, 365, true);
var cross12 = new Crossover(2960, 365, false);
var cross13 = new Crossover(3440, 365, false);
var cross14 = new Crossover(3540, 365, true);

var crossArray = [cross1, cross2, cross3, cross4, cross5, cross6, cross7, cross8, cross9, cross10, cross11, cross12, cross13, cross14];







var stationMenu = new Menus({
    x: mouseX,
    y: mouseY,
    w: 100,
    h: 80,
});

var trainMenu = new Menus({
	x: mouseX,
	y: mouseY,
	w: 100,
	h: 80,
});

var trackMenu = new Menus({
	x: mouseX,
	y: mouseY,
	w: 100,
	h:80,
})







///////////////////////////////////////////////////////////////////////////////////
//                                                              DRAW
///////////////////////////////////////////////////////////////////////////////////


draw = function() {
    
    background(112, 112, 112);    
    
    
/*
  fill(0, 0, 0);
  text("Held: " + trainA.hold + " Docked: " + trainA.docked, 30, 30);
*/

/*
fill(0, 0, 0);
for(var i=1;i<stationsArray.length;i++){
	text(stationsArray[i].position - stationsArray[i-1].position, 30 + 30*i, 200);
}*/
    
    var systemHoldButton = new Button({
      x: 20,
      y: 5,
      width: 35,
      height: 35,
      onClick: function() {
        systemH = !systemH;
      }
    });
    
    fill(160, 160, 160);
    stroke(0, 0, 0);
    strokeWeight(1);
    rect(systemHoldButton.x, systemHoldButton.y, systemHoldButton.width, systemHoldButton.height);
    fill(255, 255, 0);
    rect(systemHoldButton.x + 7, systemHoldButton.y + 7, 7, 19);
    rect(systemHoldButton.x + 21, systemHoldButton.y + 7, 7, 19);
    
    var powerButton = new Button({
      x: 55,
      y: 5,
      width: 35,
      height: 35,
      onClick: function(){
        for(var p = 0; p < tracksArray.length; p++) {
          tracksArray[p].power = !tracksArray[p].power;
          power = !power;
        }
      }
    });
    
    fill(160, 160, 160);
    stroke(0, 0, 0);
    strokeWeight(1);
    rect(powerButton.x, powerButton.y, powerButton.width, powerButton.height);
    strokeWeight(0.5);
    fill(255, 255, 0);
    beginShape(); vertex(powerButton.x + 19, powerButton.y + 4); vertex(powerButton.x + 8, powerButton.y + 19); vertex(powerButton.x + 16, powerButton.y + 17); vertex(powerButton.x + 13, powerButton.y + 32); vertex(powerButton.x + 23, powerButton.y + 13); vertex(powerButton.x + 16, powerButton.y + 14); vertex(powerButton.x + 19, powerButton.y + 4); endShape();

    
    
    
    var btn1 = new Button({
        x: trainA.position - 5,
        y: eastY,
        onClick: function() {
            trainA.atpm = !trainA.atpm;
        },
    });
    
        var btn2 = new Button({
        x: trainB.position - 5,
        y: eastY,
        onClick: function() {
            trainB.atpm = !trainB.atpm;
        },
    });
    
    var btn7 = new Button({
        x: trainG.position - 5,
        y: westY,
        onClick: function() {
            trainG.atpm = !trainG.atpm;
        },
    });



	var btnSH = new Button({
		x: stationMenu.x + 20,
		y: stationMenu.y + 10,
		width: stationMenu.w,
		height: 16,
		onClick: function() {
		  
		  for(var c = 1; c < stationMenus.length; c++) {
        if(stationMenus[c] === true) {
          stationMenus[c] = false;
          if(c % 2 === 0) {
            stationsArray[floor((c - 1) / 2)].westHold = !stationsArray[floor((c - 1) / 2)].westHold;
          } else {
            stationsArray[floor((c - 1) / 2)].eastHold = !stationsArray[floor((c - 1) / 2)].eastHold;
          }
        }
  		}
		}
	});
    

  
    
    
	var btnSC = new Button({
		x:stationMenu.x + 20,
		y: stationMenu.y + 26,
		width: stationMenu.w,
		height: 16,
		onClick: function() {
		  
  		for(var c = 1; c < stationMenus.length; c++) {
        if(stationMenus[c] === true) {
          stationMenus[c] = false;
          if(c % 2 === 0) {
            stationsArray[floor((c - 1) / 2)].westClose = !stationsArray[floor((c - 1) / 2)].westClose;
          } else {
            stationsArray[floor((c - 1) / 2)].eastClose = !stationsArray[floor((c - 1) / 2)].eastClose;
          }
        }
  		}
		}
	});
    
    


	var btnTunE = new Button({
		x: tun.position,
		y: eastY + 36,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[1] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	}); 
	var btnTunW = new Button({
		x: tun.position,
		y: westY - 36,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[2] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	}); 

	var btnBayE = new Button({
		x: bay.position,
		y: eastY + 36,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[3] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	}); 
	var btnBayW = new Button({
		x: bay.position,
		y: westY - 36,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[4] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	}); 

	var btnPimE = new Button({
		x: pim.position,
		y: eastY - 38,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[5] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	}); 
	var btnPimW = new Button({
		x: pim.position,
		y: westY + 42,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[6] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	}); 

	var btnLyoE = new Button({
		x: lyo.position,
		y: eastY + 36,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[7] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	}); 
	var btnLyoW = new Button({
		x: lyo.position,
		y: westY - 36,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[8] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	}); 

	var btnParE = new Button({
		x: par.position,
		y: eastY + 36,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[9] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	}); 
	var btnParW = new Button({
		x: par.position,
		y: westY - 36,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[10] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	}); 

	var btnRidE = new Button({
		x: rid.position,
		y: eastY + 36,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[11] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	}); 
	var btnRidW = new Button({
		x: rid.position,
		y: westY - 36,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[12] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	});
    
	var btnUotE = new Button({
		x: uot.position,
		y: eastY + 36,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[13] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	}); 
	var btnUotW = new Button({
		x: uot.position,
		y: westY - 36,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[14] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	});

	var btnLeeE = new Button({
		x: lee.position,
		y: eastY + 36,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[15] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	}); 
	var btnLeeW = new Button({
		x: lee.position,
		y: westY - 36,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[16] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	});

	var btnHurE = new Button({
		x: hur.position,
		y: eastY + 36,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[17] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	}); 
	var btnHurW = new Button({
		x: hur.position,
		y: westY - 36,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[18] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	});

	var btnTreE = new Button({
		x: tre.position,
		y: eastY + 36,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[19] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	}); 
	var btnTreW = new Button({
		x: tre.position,
		y: westY - 36,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[20] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	});

	var btnStlE = new Button({
		x: stl.position,
		y: eastY + 36,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[21] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	}); 
	var btnStlW = new Button({
		x: stl.position,
		y: westY - 36,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[22] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	});

	var btnCyrE = new Button({
		x: cyr.position,
		y: eastY - 38,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[23] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	}); 
	var btnCyrW = new Button({
		x: cyr.position,
		y: westY + 42,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[24] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	}); 

	var btnBlaE = new Button({
		x: bla.position,
		y: eastY - 38,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[25] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	}); 
	var btnBlaW = new Button({
		x: bla.position,
		y: westY + 42,
		onClick: function() {
		  for(var z = 0; z < stationMenus.length; z++) {
		    if(stationMenus[z] === true) {
		      stationsMenus[z] = false;
		    }
		  }
			stationMenus[26] = true;
			stationMenu.x = mouseX;
			stationMenu.y = mouseY;
		}
	}); 







    
    //variance[1] = run101.position - trainA.position;
    //variance[7] = trainG.position - run107.position;
    

    
    

	gidsDraw(puot.position + 35);		//portals
	drawEastPortal(puot.position - 2);
	
	gidsDraw(642);
	drawWestPortal(640);
	markerDraw(580, eastY - 2);
	markerDraw(580, westY - 2); //westDtPortal

	gidsDraw(3062);
	drawWestPortal(3060);
	markerDraw(3052, eastY - 2);
	markerDraw(3052, westY - 2); //westStlPortal

	gidsDraw(3144);
	drawEastPortal(3150);
	markerDraw(3158, eastY - 2);
	markerDraw(3158, westY - 2); //eastStlPortal


	zoneBorderDraw(600);			//zones
	zoneBorderDraw(2035);
	zoneBorderDraw(3175);

	markerDraw(600, westY - 2);		//zone markers
	markerDraw(600, eastY - 2);
	markerDraw(2035, westY - 2);
	markerDraw(2035, eastY - 2);
	markerDraw(3175, westY - 2);
	markerDraw(3175, eastY - 2);

	markerDraw(270, westY - 2);
	markerDraw(270, eastY - 2); //swt302marker
	markerDraw(1680, westY - 2);
	markerDraw(1680, eastY - 2); //swt310marker
	markerDraw(2630, eastY - 2);
	markerDraw(2610, westY - 2); //swt319markers
	markerDraw(2710, westY - 2);
	markerDraw(2845, eastY - 2);
	markerDraw(2880, westY - 2); //swt324markers
	markerDraw(2915, eastY - 2);
	markerDraw(3435, westY - 2); //swt327marker
	markerDraw(3455, eastY - 2);


  for(var s = 0; s < signalsArray.length; s++) {
    signalsArray[s].drawSignal();
  }
  for(var s = 0; s < stationsArray.length; s++) {
    stationsArray[s].drawStation();
  }
   

	puot.drawPseudo();
	phur.drawPseudo();
	ptre.drawPseudo();



	fill(255, 130, 0);
	textSize(12);
	
	text("SW_301", tun.position - 13, westY + 35);     //swtNumber
	text("SW_302", tun.position + 140, eastY - 17);
	text("SW_303", tun.position - 5, eastY - 17);
	text("SW_304", tun.position + 130, westY + 35);
	
	text("SW_305", lyo.position + 95, westY + 35);
	text("SW_306", lyo.position + 260, eastY - 17);
	text("SW_307", lyo.position + 110, eastY - 17);
	text("SW_308", lyo.position + 245, westY + 35);

	text("SW_309", puot.position - 10, westY + 35);
	text("SW_310", puot.position + 140, eastY - 17);
	text("SW_311", puot.position + 5, eastY - 17);
	text("SW_312", puot.position + 125, westY + 35); 

	text("SW_313", 2170, eastY - 17);
	text("SW_314", 2155, westY - 11);
	text("SW_315", 2350, westY + 31);
	text("SW_316", 2398, eastY - 14);

	text("SW_317", 2485, eastY - 11);
	text("SW_318", 2490, westY + 35);
	text("SW_319", 2660, westY + 35);
	text("SW_320", 2700, eastY - 11);

	text("SW_323", 2890, eastY - 11);
	text("SW_324", 2850, westY + 35);
	text("SW_325", 2990, westY + 31);
	text("SW_326", 2950, eastY - 11);

	text("SW_327", 3470, westY + 35);
	text("SW_328", 3420, eastY - 11);
	text("SW_329", 3508, eastY - 22);
	text("SW_330", 3528, westY + 35);



	/*    
	if(flankUOTeast === true || flankUOTeast === true) {
		stroke(0, 0, 0);
		strokeWeight(0.4);
		fill(255, 0, 255);
		ellipse(puot.position + 52, eastY + 7, 13, 13);
		ellipse(puot.position + 116, westY + 7, 13, 13);
		ellipse(puot.position + 116, eastY + 7, 13, 13);
		ellipse(puot.position + 52, westY + 7, 13, 13);
	}  
*/


   /*
	fill(192, 192, 192);
	if(power === true) {
		noStroke();
	} else {
		stroke(0, 255, 0);			//powerStatus
		strokeWeight(3);
	}
	rect(20, eastY + 2, 3760, 11);                      //track2
	rect(20, westY + 2, 3760, 11);                      //track1
	*/
	
	

    
	
	for(var t = 0; t < tracksArray.length; t++) {
	  tracksArray[t].drawTrack();
	}


	for(var c = 0; c < crossArray.length; c++) {
		crossArray[c].drawCross();
	}
    







	for(var t = 0; t < trainsArray.length; t++) {
		trainsArray[t].drawTrain();
	}

  for(var r = 0; r < runsArray.length; r++) {
    runsArray[r].drawShadow();
  }
    
    
    
    //btn1.draw();
    //btn7.draw();

	mouseClicked = function() {
	  
	systemHoldButton.handleMouseClick();
	powerButton.handleMouseClick();
	  
	btn1.handleMouseClick();
	btn7.handleMouseClick();
    
	btnSH.handleMouseClick();
	btnSC.handleMouseClick();

  	btnTunE.handleMouseClick();
	  btnTunW.handleMouseClick();
  	btnBayE.handleMouseClick();
  	btnBayW.handleMouseClick();
  	btnPimE.handleMouseClick();
  	btnPimW.handleMouseClick();
  	btnLyoE.handleMouseClick();
  	btnLyoW.handleMouseClick();
  	btnParE.handleMouseClick();
  	btnParW.handleMouseClick();
  	btnRidE.handleMouseClick();
  	btnRidW.handleMouseClick();
  	btnUotE.handleMouseClick();
  	btnUotW.handleMouseClick();
  	btnLeeE.handleMouseClick();
  	btnLeeW.handleMouseClick();
  	btnHurE.handleMouseClick();
  	btnHurW.handleMouseClick();
  	btnTreE.handleMouseClick();
  	btnTreW.handleMouseClick();
  	btnStlE.handleMouseClick();
  	btnStlW.handleMouseClick();
  	btnCyrE.handleMouseClick();
  	btnCyrW.handleMouseClick();
  	btnBlaE.handleMouseClick();
  	btnBlaW.handleMouseClick();


  };
    
	for(i = 0; i < stationMenus.length; i++) {
    if(stationMenus[i] === true) {
		  stationMenu.drawStationMenu();
		  for(m = 0; m < stationMenus.length; m++) {
		    if (m != i) {
			    stationMenus[m] = false
		    }
		  }
		}
	}
    
    
};


//planned features to add
	//track segments
  //line
	//LMAs
	//stnClose fn
	//swt fn
	//disturb switch
	//select track
	//track fns
    //MRR
    //powerStatus
  //eb
  //additional lines
  //alt TDT
  //dwell+/-
  //cross switches?
  //local processingJS source?



//if (frameCount % 60 === 0)      <--slow movement?
//if (random(0,1) < 0.5)          <--50/50 random?






			}
		};

    // Get the canvas that Processing-js will use
    var canvas = document.getElementById("mycanvas"); 
    // Pass the function sketchProc (defined in myCode.js) to Processing's constructor.
    var processingInstance = new Processing(canvas, sketchProc); 
	</script>
	</body>
</html>